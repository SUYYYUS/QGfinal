CREATE DATABASE QGfinal_test;

use QGfinal_test;

-- 教师表
create table tb_teacher
(
    id int unsigned auto_increment comment '主键ID',
    teachername varchar(20) not null comment '教师名字',
    teacherid varchar(20) not null comment '教职工号',
    password varchar(300) not null comment '密码',
    college varchar(20) not null comment '所属学院',
    qq varchar(20) null comment 'QQ',
    email varchar(50) null comment '电子邮箱',
    description varchar(100) null comment '个人介绍',
    create_time varchar(50) not null comment '注册时间',
    update_time varchar(50) not null comment '更新时间',
    constraint tb_teacher_pk
        primary key (id)
)
    comment '教师表';

create unique index tb_teacher_email_uindex
    on tb_teacher (email);

create unique index tb_teacher_qq_uindex
    on tb_teacher (qq);

create unique index tb_teacher_teacherid_uindex
    on tb_teacher (teacherid);

-- 学生表
create table tb_student
(
    id int unsigned auto_increment comment '主键ID',
    studentname varchar(20) not null comment '学生姓名',
    studentid varchar(20) not null comment '学号',
    password varchar(300) not null comment '密码',
    grade varchar(10) null comment '年级',
    qq varchar(20) null comment 'QQ',
    description varchar(50) null comment '个人介绍',
    create_time varchar(30) not null comment '注册时间',
    update_time varchar(30) null comment '修改时间',
    constraint tb_student_pk
        primary key (id)
)
    comment '学生表';

create unique index tb_student_studentid_uindex
    on tb_student (studentid);

-- 课程表
create table tb_course
(
	id int unsigned auto_increment comment '主键ID',
	coursename varchar(20) not null comment '课程名称',
	subject varchar(10) not null comment '所属学科',
	description varchar(50) null comment '课程描述',
	teacher_id int unsigned not null comment '教师ID',
	limitnumber int not null comment '限制人数',
	registernumber int default 0 not null comment '报名人数',
	create_time varchar(30) not null comment '开课时间',
	end_time varchar(30) not null comment '结课时间',
	section_number int default 0 null comment '章节数',
	constraint tb_course_pk
		primary key (id)
)
comment '课程表';

-- 课程章节表
create table tb_course_section
(
    id int unsigned auto_increment comment '主键ID',
    sectionname varchar(20) not null comment '章节名称',
    content varchar(300) not null comment '章节内容',
    course_id int unsigned not null comment '课程ID',
    create_time varchar(30) not null comment '发布时间',
    constraint tb_course_section_pk
        primary key (id)
)
    comment '课程章节表';

-- 题目表
create table tb_question
(
    id int unsigned auto_increment comment '主键ID',
    type varchar(10) not null comment '题目类型',
    content varchar(200) not null comment '题目内容',
    answer varchar(20) not null comment '答案',
    score int not null comment '分值',
    course_section_id int unsigned not null comment '章节ID',
    course_id int unsigned not null comment '课程ID',
    create_time varchar(30) not null comment '发布时间',
    constraint tb_question_pk
        primary key (id)
)
    comment '题目表';


-- 答题记录表
create table tb_student_answer
(
    id int unsigned auto_increment comment '主键ID',
    student_id int unsigned not null comment '学生ID',
    question_id int unsigned not null comment '题目ID',
    answer varchar(20) not null comment '学生答案',
    score int default 0 not null comment '得分',
    answer_time varchar(30) not null comment '答题时间',
    constraint tb_student_answer_pk
        primary key (id)
)
    comment '学生答题记录表';


-- 学生课程表
create table tb_student_course
(
    id int unsigned auto_increment comment '主键ID',
    student_id int unsigned not null comment '学生ID',
    course_id int unsigned not null comment '课程ID',
    register_time varchar(30) not null comment '报名时间',
    status int unsigned null comment '状态：1.学习中，2.已完成',
    constraint tb_student_course_pk
        primary key (id)
)
    comment '学生课程表';


-- 记得在课程表上加了一栏章节数的代码，后面要注意补上

-- 在答题记录表上添加了一栏课程id
alter table tb_student_answer
	add course_id int unsigned not null comment '课程ID' after question_id;


-- 学生学习情况表
create table tb_student_study
(
    id            int unsigned auto_increment comment '主键ID'
        primary key,
    student_id    int unsigned     not null comment '学生ID',
    course_id     int unsigned     not null comment '课程ID',
    answernumber  int    default 0 null comment '答题次数',
    average_score double default 0 null comment '平均分',
    total_score   double default 0 null comment '总分',
    accuracy      double default 0 null comment '正确率'
)
    comment '学生学习情况表';

alter table tb_student_study
    add rightnumber int default 0 null comment '答对次数';