<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生情况</title>
</head>
<body>

<div id="coursestudentsituationDiv">

<!--    <h2 v-model="Course.coursename">{{Course.coursename}}</h2>-->
<!--    <el-button type="text" @click="dialogTableVisible = true">打开嵌套表格的 Dialog</el-button>-->

    <el-dialog title="学习情况" :visible.sync="dialogTableVisible">
        <el-table :data="gridData">
            <el-table-column property="answernumber" label="作答次数" width="150"></el-table-column>
            <el-table-column property="average_score" label="平均分" width="200"></el-table-column>
            <el-table-column property="total_score" label="总分"></el-table-column>
            <el-table-column property="accuracy" label="正确率" width="200"></el-table-column>
        </el-table>
    </el-dialog>


    <template>
        <el-table
                :data="tableData"
                style="width: 100%"
                :row-class-name="tableRowClassName"
                @selection-change="handleSelectionChange">
            <el-table-column
                    type="index"
                    width="50">
            </el-table-column>
            <el-table-column
                    prop="studentname"
                    label="姓名"
                    align="center"
            >
            </el-table-column>
            <el-table-column
                    prop="studentid"
                    label="学号"
                    align="center"
            >
            </el-table-column>
            <el-table-column
                    prop="grade"
                    label="年级"
                    align="center"
            >
            </el-table-column>
            <el-table-column
                    prop="qq"
                    label="QQ"
                    align="center"
            >
            </el-table-column>
            <el-table-column
                    prop="id"
                    align="center"
                    label="操作">
                <template slot-scope="scope">
                    <el-row>
                        <el-button type="primary" @click="checklearning(scope.row)">获取学习情况</el-button>
<!--                        <el-button type="text" @click="dialogTableVisible = true">查看学习情况</el-button>-->
                    </el-row>
                </template>
            </el-table-column>
        </el-table>
    </template>

    <el-row>
        <el-button type="primary" @click="gobackteachercenter" round>返回个人信息中心</el-button>
    </el-row>


</div>


<script src="js/axios-0.18.0.js"></script>
<script src="js/vue.js"></script>
<script src="element-ui/lib/index.js"></script>
<link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">

<script>
    new Vue({
        el:"#coursestudentsituationDiv",

        mounted(){

            this.showRegisterStudent();
        },

        data(){
            return{
                dialogTableVisible:false,

                Student:{
                    id:'',
                    studentname:'',
                    studentid:'',
                    password:'',
                    grade:'',
                    qq:'',
                    description:'',
                    create_time:'',
                    update_time:'',

                },

                Course:{
                    id:'',
                    coursename:'',
                    subject:'',
                    description:'',
                    teacher_id:'',
                    section_number:'',
                    limitnumber:'',
                    registernumber:'',
                    create_time:'',
                    end_time:'',
                },

                tableData:[],
                gridData:[],

                Student_study:{
                    id:'',
                    student_id:'',
                    course_id:'',
                    answernumber:'',
                    average_score:'',
                    total_score:'',
                    accuracy:'',
                    rightnumber:'',

                },
            }
        },

        methods:{

            //展示报名这个课程的学生
            showRegisterStudent(){
                var _this = this;

                axios({
                    method:"get",
                    url:"http://localhost:8080/QGfinal_test_war/Student_course/showRegisterStudent",
                }).then(resp =>{
                    //设置表格数据
                    _this.tableData = resp.data;
                })

            },


            //展示当前课程信息
            queryCourse(){
                var _this = this;
                axios({
                    method: "get",
                    url:"http://localhost:8080/QGfinal_test_war/Course/getSelfInformation",
                }).then(resp =>{
                    _this.Course.coursename = resp.data.coursename;

                    // _this.tableData = resp.data;
                });
            },

            tableRowClassName({row, rowIndex}) {
                if (rowIndex%2 === 0) {
                    return 'warning-row';
                } //else  {
                //return 'success-row';
                //}
                return 'success-row';
            },
            //复选框选中后执行的方法
            handleSelectionChange(val) {
                this.multipleSelection = val;

            },

            //跳转到查看学生的学习情况
            checklearning(row){
                var _this = this;
                this.Student = row;

                axios({
                    method:"post",
                    url:"http://localhost:8080/QGfinal_test_war/Student/queryByIdAndSession",
                    data:this.Student.id,
                }).then(function (resp) {
                    if(resp.data == "success"){
                        _this.seeStudy();
                        _this.$message({
                            message: '获取成功',
                            type: 'success'
                        });

                        //打开学习情况表单



                    }
                })
            },

            seeStudy(){
                var _this = this;

                axios({
                    method:"get",
                    url:"http://localhost:8080/QGfinal_test_war/Student_study/getStudyInformation"
                }).then(resp =>{

                    _this.Student_study = resp.data;

                    _this.gridData = Array.isArray(resp.data) ? resp.data : [resp.data];

                    // _this.tableData = resp.data;
                    console.log(_this.Student_study);
                    _this.dialogTableVisible = true;
                });

            },


            gobackteachercenter(){
                location.href = "/QGfinal_test_war/TeacherCenter.html";
            }
        }


    })

</script>
<script>
    function checklearn() {
        location.href = "AdminCenter.html";
    }
</script>


</body>
</html>