<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>课程操作</title>
    <style>
        .welcome{
            /*text-align: center;*/
            color: #cdb1ef;
        }
    </style>
</head>
<body>
<div id="sectionDiv">
    <h2 class = "welcome" >当前课程</h2>
    <!--    新增课程-->
    <el-dialog
            title="新增课程"
            :visible.sync="dialogVisible"
            width="30%"
    >
        <el-form ref="form" :model="Section" label-width="80px">
            <el-form-item label="章节名">
                <el-input v-model="Section.sectionname"></el-input>
            </el-form-item>
            <el-form-item label="教学内容">
                <el-input v-model="Section.content"></el-input>
            </el-form-item>
<!--            <el-form-item label="简要描述">-->
<!--                <el-input v-model="Course.description"></el-input>-->
<!--            </el-form-item>-->
<!--            <el-form-item label="限制人数">-->
<!--                <el-input v-model="Course.limitnumber"></el-input>-->
<!--            </el-form-item>-->
            <el-form-item>
                <el-button type="primary" @click="addSection">提交</el-button>
                <el-button @click="dialogVisible = false">取消</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>

    <el-dialog title="学习情况" :visible.sync="dialogTableVisible_total">
        <table border="1px" cellspacing = "0" width = "600px">
            <tr>
                <th>学习人数</th>
                <th>学生平均分</th>
                <th>学生平均正确率</th>

            </tr>
            <tr>
                <!--            <td><img src="Pt/DSC_1256.jpg" width="100px"></td>-->
                <td>{{studynumberdata}}</td>
                <td>{{totalaverage_scoredata}}</td>
                <td>{{totalaccuracydata}}</td>
            </tr>
        </table>
    </el-dialog>


<!--课程信息-->
<template>
    <el-table
            :data="tableData"
            style="width: 100%"
            :row-class-name="tableRowClassName"
            @selection-change="handleSelectionChange">
                    <el-table-column
                            type="selection"
                            width="55">
                    </el-table-column>
        <el-table-column
                type="index"
                width="50">
        </el-table-column>
        <el-table-column
                prop="coursename"
                label="课程"
                align="center"
        >
        </el-table-column>
                    <el-table-column
                            prop="subject"
                            label=学科分类
                            align="center"
                    >
                    </el-table-column>
                    <el-table-column
                            prop="description"
                            label="描述"
                            align="center"
                    >
                    </el-table-column>
                    <el-table-column
                            prop="section_number"
                            label="章节数"
                            align="center"
                    >
                    </el-table-column>
        <el-table-column
                prop="limitnumber"
                label="限制人数"
                align="center"
        >
        </el-table-column>
        <el-table-column
                prop="registernumber"
                label="报名人数"
                align="center"
        >
        </el-table-column>
                    <el-table-column
                            prop="create_time"
                            label="开课时间"
                            align="center"
                    >
                    </el-table-column>
        <el-table-column
                prop="end_time"
                label="结课时间"
                align="center"
        >
        </el-table-column>
        </el-table-column>
        <el-table-column
                prop="id"
                align="center"
                label="操作">
            <template slot-scope="scope">
                <el-row>
                    <el-button type="primary" @click="dialogVisible = true">添加章节</el-button>
                    <el-button type="primary" @click="dialogTableVisible_total = true">查看学习情况</el-button>
                    <el-button type="primary" @click="gotocourseforum(scope.row)">进入讨论区</el-button>
                </el-row>
            </template>
        </el-table-column>
    </el-table>
</template>

    <h2 class = "welcome" >课程章节</h2>

    <template>
        <el-table
                :data="tableData1"
                style="width: 100%"
                :row-class-name="tableRowClassName"
                @selection-change="handleSelectionChange">
            <el-table-column
                    type="selection"
                    width="55">
            </el-table-column>
            <el-table-column
                    type="index"
                    width="50">
            </el-table-column>
            <el-table-column
                    prop="sectionname"
                    label="章节名称"
                    align="center"
            >
            </el-table-column>
            <el-table-column
                    prop="content"
                    label=教学内容
                    align="center"
            >
            </el-table-column>



            <el-table-column
                    prop="create_time"
                    label="创建时间"
                    align="center"
            >
            </el-table-column>

            <el-table-column
                    prop="id"
                    align="center"
                    label="操作">
                <template slot-scope="scope">
                    <el-row>
                        <el-button type="primary" @click="addQuestion(scope.row)">查看详情</el-button>
                    </el-row>
                </template>
            </el-table-column>
        </el-table>
    </template>

    <el-row>
        <el-button type="primary" @click="goback" plain>返回</el-button>
        <el-button type="primary" @click="gotochatroom" plain>进入聊天室</el-button>
    </el-row>
</div>

<script src="js/axios-0.18.0.js"></script>
<script src="js/vue.js"></script>
<script src="element-ui/lib/index.js"></script>
<link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">

<script>
    new Vue({
        el:"#sectionDiv",

        mounted(){
            this.queryCourse();
            this.queryAllSection();
            this.studynumber();
                this.totalaverage_score();
                this.totalaccuracy();

        },

        data(){
            return{

                dialogTableVisible_total: false,

                Course:{
                    id:'',
                    coursename:'',
                    subject:'',
                    description:'',
                    teacher_id:'',
                    section_number:'',
                    limitnumber:'',
                    registernumber:'',
                    create_time:'',
                    end_time:'',
                },

                tableData: [],

                dialogVisible:false,

                tableData1: [],

                Section:{
                    id:'',
                    sectionname:'',
                    course_id:'',
                    create_time:'',
                },

                studynumberdata:'',
                totalaverage_scoredata:'',
                totalaccuracydata:'',


            }
        },


        methods:{

            //展示当前课程信息
            queryCourse(){
                var _this = this;
                axios({
                    method: "get",
                    url:"http://localhost:8080/QGfinal_test_war/Course/getSelfInformation",
                }).then(resp =>{
                    _this.tableData = Array.isArray(resp.data) ? resp.data : [resp.data];

                    // _this.tableData = resp.data;
                });
            },

            //添加章节
            addSection(){

                var _this = this;

                axios({
                    method:"post",
                    url:"http://localhost:8080/QGfinal_test_war/Section/addSection",
                    data:this.Section,
                }).then(function (resp) {
                    if(resp.data == "success"){
                        //关闭对话框
                        _this.dialogVisible = false;
                        //提示添加成功
                        _this.$message({
                            message: '恭喜你，添加成功啦',
                            type: 'success'
                        });
                        //刷新章节表
                        _this.queryAllSection();
                        //刷新课程表
                        _this.queryCourse();
                    }
                })

            },

            //展示所有章节
            queryAllSection(){

                var _this = this;

                axios({
                    method:"get",
                    url:"http://localhost:8080/QGfinal_test_war/Section/selectAllSectionBycourse_id",
                }).then(resp =>{
                    //设置表格数据
                    this.tableData1 = resp.data;
                })
            },

            tableRowClassName({row, rowIndex}) {
                if (rowIndex%2 === 0) {
                    return 'warning-row';
                } //else  {
                //return 'success-row';
                //}
                return 'success-row';
            },
            //复选框选中后执行的方法
            handleSelectionChange(val) {
                this.multipleSelection = val;

            },

            //返回上一页面
            goback(){
                location.href = "/QGfinal_test_war/TeacherCenter.html";
            },

            addQuestion(row){
                var _this = this;

                this.Section = row;
                console.log(this.Section);
                axios({
                    method:"post",
                    url:"http://localhost:8080/QGfinal_test_war/Section/queryByIdAndSession",
                    data:_this.Section.id,
                }).then(function (resp) {
                    if(resp.data == "success"){
                        f();
                    }
                })


            },


            //记录学习人数
            studynumber(){
                var _this = this;
                axios({
                    method: "get",
                    url:"http://localhost:8080/QGfinal_test_war/Student_study/getStudynumber",
                }).then(resp =>{
                    _this.studynumberdata = resp.data;

                    console.log(_this.studynumberdata);

                });
            },

            totalaverage_score(){
                var _this = this;
                axios({
                    method: "get",
                    url:"http://localhost:8080/QGfinal_test_war/Student_study/gettotalaverage_score",
                }).then(resp =>{
                    _this.totalaverage_scoredata = resp.data;

                    console.log(_this.totalaverage_scoredata);

                });


            },


            totalaccuracy(){

                var _this = this;
                axios({
                    method: "get",
                    url:"http://localhost:8080/QGfinal_test_war/Student_study/gettotalaccuracy",
                }).then(resp =>{
                    _this.totalaccuracydata = resp.data;

                    console.log(_this.totalaccuracydata);

                });


            },


            gotocourseforum(row){
                var _this = this;
                _this.Course = row;
                axios({
                    method:"post",
                    url:"http://localhost:8080/QGfinal_test_war/Course/queryByIdAndSession",
                    data:_this.Course.id,
                }).then(function (resp) {
                    if(resp.data == "success"){
                        location.href = "/QGfinal_test_war/TeacherCourseDiscussion.html";

                    }
                })

            },

            gotochatroom(){
            location.href = "teacherindex.html";
            }

        },




    })
</script>
<script>
    function f() {
        location.href = "/QGfinal_test_war/SectionQuestion.html";
    }
</script>
</body>
</html>